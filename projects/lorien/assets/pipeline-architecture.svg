<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="840" height="220" viewBox="0 0 840 220">
  <rect width="840" height="220" fill="#0d1117" rx="12"/>

  <!-- Stage boxes -->
  <rect x="30" y="50" width="120" height="70" rx="10" fill="#0d1117" stroke="#39d353" stroke-width="2"/>
  <text x="90" y="78" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="16" font-weight="700" fill="#39d353" text-anchor="middle">Simulate</text>
  <text x="90" y="100" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="11" fill="#8b949e" text-anchor="middle">Event-sourced sim</text>

  <rect x="195" y="50" width="120" height="70" rx="10" fill="#0d1117" stroke="#d29922" stroke-width="2"/>
  <text x="255" y="78" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="16" font-weight="700" fill="#d29922" text-anchor="middle">Canon</text>
  <text x="255" y="100" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="11" fill="#8b949e" text-anchor="middle">Persistent world state</text>

  <rect x="360" y="50" width="120" height="70" rx="10" fill="#0d1117" stroke="#a371f7" stroke-width="2"/>
  <text x="420" y="78" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="16" font-weight="700" fill="#a371f7" text-anchor="middle">Score</text>
  <text x="420" y="100" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="11" fill="#8b949e" text-anchor="middle">Tension + irony metrics</text>

  <rect x="525" y="50" width="120" height="70" rx="10" fill="#0d1117" stroke="#58a6ff" stroke-width="2"/>
  <text x="585" y="78" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="16" font-weight="700" fill="#58a6ff" text-anchor="middle">Extract</text>
  <text x="585" y="100" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="11" fill="#8b949e" text-anchor="middle">Arc grammar search</text>

  <rect x="690" y="50" width="120" height="70" rx="10" fill="#0d1117" stroke="#f78166" stroke-width="2"/>
  <text x="750" y="78" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="16" font-weight="700" fill="#f78166" text-anchor="middle">Narrate</text>
  <text x="750" y="100" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="11" fill="#8b949e" text-anchor="middle">Dual-LLM prose</text>

  <!-- Forward arrows -->
  <line x1="150" y1="85" x2="195" y2="85" stroke="#8b949e" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="315" y1="85" x2="360" y2="85" stroke="#8b949e" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="480" y1="85" x2="525" y2="85" stroke="#8b949e" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="645" y1="85" x2="690" y2="85" stroke="#8b949e" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Lore loop feedback arrow (Narrate â†’ Canon) -->
  <path d="M 750 120 L 750 170 Q 750 185 735 185 L 270 185 Q 255 185 255 170 L 255 120"
        fill="none" stroke="#d29922" stroke-width="1.5" stroke-dasharray="6,3" marker-end="url(#arrow-gold)"/>
  <text x="490" y="180" font-family="-apple-system, BlinkMacSystemFont, 'Segoe UI', system-ui, sans-serif" font-size="12" font-weight="600" fill="#d29922" text-anchor="middle">Lore Loop</text>

  <!-- Arrow markers -->
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#8b949e"/>
    </marker>
    <marker id="arrow-gold" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#d29922"/>
    </marker>
  </defs>
</svg>
